{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\ADMIN\\\\Desktop\\\\Hoc ReactJS\\\\wetravelfrontend\\\\src\\\\components\\\\pages\\\\AfterPay\\\\index.js\",\n    _s = $RefreshSig$();\n\nimport { memo, useState, useEffect } from 'react';\nimport { Navigate } from 'react-router-dom';\nimport axios from 'axios';\nimport { API_ADD_BOOKING, API_PAY_TOUR, API_PAY_DEPOSIT_TOUR } from '../../API';\nimport LoadingDialog from '../../Layout/LoadingDialog';\nimport { toast } from 'react-toastify';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction AfterPay() {\n  _s();\n\n  //Mastercard\n  //partnerCode=MOMO&orderId=1667983950744&requestId=1667983950744&amount=6800000&orderInfo=Tour+Bái+Đính+-+10+Adult%2C+4+Children&orderType=momo_wallet&transId=2787130271&resultCode=0&message=Giao+dịch+thành+công.&payType=credit&responseTime=1667984079748&extraData=&signature=2e5204a9a17619a1ec242264e1320048210ef35fa38959b20bed1bec38ca6838\n  //Momo\n  //partnerCode=MOMO&orderId=1667984196662&requestId=1667984196662&amount=500000&orderInfo=Tour+Bái+Đính+-+1+Adult%2C+0+Children&orderType=momo_wallet&transId=2787130349&resultCode=0&message=Giao+dịch+thành+công.&payType=qr&responseTime=1667984243232&extraData=&signature=100e926d02fd3affbd8f488f5c610c02771f8cd9c7fae4ef47cb8b6db4293a9e\n  //tourId=1&isDeposit=true&bookingId=-1&isUpdate=false&partnerCode=MOMO&orderId=1668445407338&requestId=1668445407338&amount=500000&orderInfo=Test+tour+custom+-+1+Người+lớn%2C+0+Trẻ+em&orderType=momo_wallet&transId=1668445414067&resultCode=1006&message=Giao+dịch+bị+từ+chối+bởi+người+dùng.&payType=&responseTime=1668445414091&extraData=&signature=049586ed30f6807ed6aa3fb728f174e336be546aca2312089c5ce584e375d72f\n  const [addBookingComplete, setAddBookingComplete] = useState(false);\n  const queryString = window.location.search;\n  const urlParams = new URLSearchParams(queryString);\n  let cookie = {};\n  document.cookie.split(';').forEach(function (el) {\n    let [key, value] = el.split('=');\n    cookie[key.trim()] = value;\n  });\n  const language = cookie['languageSelected'] ? 'EN' : cookie['languageSelected'];\n  const booking = {\n    tourId: urlParams.get('tourId'),\n    isDeposit: urlParams.get('isDeposit'),\n    orderId: urlParams.get('orderId'),\n    totalPrice: urlParams.get('amount'),\n    orderTitle: urlParams.get('orderInfo'),\n    result: urlParams.get('resultCode') == 0,\n    payType: urlParams.get('payType'),\n    bookingId: urlParams.get('bookingId'),\n    isUpdate: urlParams.get('isUpdate'),\n    fullName: urlParams.get('fullName'),\n    phone: urlParams.get('phone'),\n    email: urlParams.get('email'),\n    promoCode: urlParams.get('promoCode'),\n    request: urlParams.get('request'),\n    idCard: urlParams.get('idCard'),\n    dateOfIssue: urlParams.get('dateOfIssue'),\n    placeOfIssue: urlParams.get('placeOfIssue'),\n    startDate: urlParams.get('startDate'),\n    numberOfAdult: urlParams.get('numberOfAdult'),\n    numberOfChildren: urlParams.get('numberOfChildren'),\n    bookingDate: new Date().toISOString().split(\"T\")[0],\n    accountId: sessionStorage.getItem('id'),\n    status: urlParams.get('type') == 1 ? 1 : 0,\n    statusDeposit: urlParams.get('type') == 1 ? 0 : 1,\n    adultPrice: urlParams.get('adultPrice'),\n    childrenPrice: urlParams.get('childrenPrice')\n  };\n  useEffect(() => {\n    if (booking.result) {\n      if (booking.isUpdate == 'false') {\n        axios.post(API_ADD_BOOKING, booking).then(() => {\n          setAddBookingComplete(true);\n          toast.success(language === 'EN' ? 'Booking success' : 'Đặt thành công');\n        });\n      } else if (booking.isUpdate == 'true') {\n        if (booking.isDeposit == 'true') {\n          axios.post(API_PAY_DEPOSIT_TOUR, {\n            params: {\n              userBookingId: booking.bookingId,\n              statusDeposit: 1\n            }\n          }).then(() => {\n            setAddBookingComplete(true);\n            toast.success(language === 'EN' ? 'Successful booking' : 'Đặt thành công');\n          });\n        } else {\n          axios.post(API_PAY_TOUR, {\n            params: {\n              userBookingId: booking.bookingId,\n              status: 1\n            }\n          }).then(() => {\n            setAddBookingComplete(true);\n            toast.success(language === 'EN' ? 'Successful deposit' : 'Đặt cọc thành công');\n          });\n        }\n      }\n    } else {\n      setAddBookingComplete(true);\n    }\n  }, []);\n\n  if (!addBookingComplete) {\n    return /*#__PURE__*/_jsxDEV(LoadingDialog, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 97,\n      columnNumber: 17\n    }, this);\n  }\n\n  return /*#__PURE__*/_jsxDEV(Navigate, {\n    to: `${booking.result ? '/profile' : '/tours'}`\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 100,\n    columnNumber: 13\n  }, this);\n}\n\n_s(AfterPay, \"TU5Lqqtu1raMT/pyg8+maOFkSkY=\");\n\n_c = AfterPay;\nexport default _c2 = /*#__PURE__*/memo(AfterPay);\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"AfterPay\");\n$RefreshReg$(_c2, \"%default%\");","map":{"version":3,"names":["memo","useState","useEffect","Navigate","axios","API_ADD_BOOKING","API_PAY_TOUR","API_PAY_DEPOSIT_TOUR","LoadingDialog","toast","AfterPay","addBookingComplete","setAddBookingComplete","queryString","window","location","search","urlParams","URLSearchParams","cookie","document","split","forEach","el","key","value","trim","language","booking","tourId","get","isDeposit","orderId","totalPrice","orderTitle","result","payType","bookingId","isUpdate","fullName","phone","email","promoCode","request","idCard","dateOfIssue","placeOfIssue","startDate","numberOfAdult","numberOfChildren","bookingDate","Date","toISOString","accountId","sessionStorage","getItem","status","statusDeposit","adultPrice","childrenPrice","post","then","success","params","userBookingId"],"sources":["C:/Users/ADMIN/Desktop/Hoc ReactJS/wetravelfrontend/src/components/pages/AfterPay/index.js"],"sourcesContent":["import { memo, useState, useEffect } from 'react'\r\nimport { Navigate } from 'react-router-dom'\r\nimport axios from 'axios'\r\nimport { API_ADD_BOOKING, API_PAY_TOUR, API_PAY_DEPOSIT_TOUR } from '../../API'\r\nimport LoadingDialog from '../../Layout/LoadingDialog'\r\nimport { toast } from 'react-toastify'\r\n\r\nfunction AfterPay() {\r\n    //Mastercard\r\n    //partnerCode=MOMO&orderId=1667983950744&requestId=1667983950744&amount=6800000&orderInfo=Tour+Bái+Đính+-+10+Adult%2C+4+Children&orderType=momo_wallet&transId=2787130271&resultCode=0&message=Giao+dịch+thành+công.&payType=credit&responseTime=1667984079748&extraData=&signature=2e5204a9a17619a1ec242264e1320048210ef35fa38959b20bed1bec38ca6838\r\n\r\n    //Momo\r\n    //partnerCode=MOMO&orderId=1667984196662&requestId=1667984196662&amount=500000&orderInfo=Tour+Bái+Đính+-+1+Adult%2C+0+Children&orderType=momo_wallet&transId=2787130349&resultCode=0&message=Giao+dịch+thành+công.&payType=qr&responseTime=1667984243232&extraData=&signature=100e926d02fd3affbd8f488f5c610c02771f8cd9c7fae4ef47cb8b6db4293a9e\r\n\r\n    //tourId=1&isDeposit=true&bookingId=-1&isUpdate=false&partnerCode=MOMO&orderId=1668445407338&requestId=1668445407338&amount=500000&orderInfo=Test+tour+custom+-+1+Người+lớn%2C+0+Trẻ+em&orderType=momo_wallet&transId=1668445414067&resultCode=1006&message=Giao+dịch+bị+từ+chối+bởi+người+dùng.&payType=&responseTime=1668445414091&extraData=&signature=049586ed30f6807ed6aa3fb728f174e336be546aca2312089c5ce584e375d72f\r\n\r\n    const [addBookingComplete, setAddBookingComplete] = useState(false)\r\n    const queryString = window.location.search;\r\n    const urlParams = new URLSearchParams(queryString);\r\n\r\n    let cookie = {};\r\n    document.cookie.split(';').forEach(function (el) {\r\n        let [key, value] = el.split('=');\r\n        cookie[key.trim()] = value;\r\n    })\r\n\r\n    const language = cookie['languageSelected'] ? 'EN' : cookie['languageSelected']\r\n\r\n    const booking = {\r\n        tourId: urlParams.get('tourId'),\r\n        isDeposit: urlParams.get('isDeposit'),\r\n        orderId: urlParams.get('orderId'),\r\n        totalPrice: urlParams.get('amount'),\r\n        orderTitle: urlParams.get('orderInfo'),\r\n        result: urlParams.get('resultCode') == 0,\r\n        payType: urlParams.get('payType'),\r\n        bookingId: urlParams.get('bookingId'),\r\n        isUpdate: urlParams.get('isUpdate'),\r\n        fullName: urlParams.get('fullName'),\r\n        phone: urlParams.get('phone'),\r\n        email: urlParams.get('email'),\r\n        promoCode: urlParams.get('promoCode'),\r\n        request: urlParams.get('request'),\r\n        idCard: urlParams.get('idCard'),\r\n        dateOfIssue: urlParams.get('dateOfIssue'),\r\n        placeOfIssue: urlParams.get('placeOfIssue'),\r\n        startDate: urlParams.get('startDate'),\r\n        numberOfAdult: urlParams.get('numberOfAdult'),\r\n        numberOfChildren: urlParams.get('numberOfChildren'),\r\n        bookingDate: new Date().toISOString().split(\"T\")[0],\r\n        accountId: sessionStorage.getItem('id'),\r\n        status: urlParams.get('type') == 1 ? 1 : 0,\r\n        statusDeposit: urlParams.get('type') == 1 ? 0 : 1,\r\n        adultPrice: urlParams.get('adultPrice'),\r\n        childrenPrice: urlParams.get('childrenPrice')\r\n    }\r\n\r\n    useEffect(() => {\r\n        if (booking.result) {\r\n            if (booking.isUpdate == 'false') {\r\n                axios.post(API_ADD_BOOKING, booking).then(() => {\r\n                    setAddBookingComplete(true)\r\n                    toast.success(language === 'EN' ? 'Booking success' : 'Đặt thành công')\r\n                })\r\n            }\r\n            else if (booking.isUpdate == 'true') {\r\n                if (booking.isDeposit == 'true') {\r\n                    axios.post(API_PAY_DEPOSIT_TOUR, {\r\n                        params: {\r\n                            userBookingId: booking.bookingId,\r\n                            statusDeposit: 1\r\n                        }\r\n                    }).then(() => {\r\n                        setAddBookingComplete(true)\r\n                        toast.success(language === 'EN' ? 'Successful booking' : 'Đặt thành công')\r\n                    })\r\n                }\r\n                else {\r\n                    axios.post(API_PAY_TOUR, {\r\n                        params: {\r\n                            userBookingId: booking.bookingId,\r\n                            status: 1\r\n                        }\r\n                    }).then(() => {\r\n                        setAddBookingComplete(true)\r\n                        toast.success(language === 'EN' ? 'Successful deposit' : 'Đặt cọc thành công')\r\n                    })\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            setAddBookingComplete(true)\r\n        }\r\n    }, [])\r\n\r\n    if (!addBookingComplete) {\r\n        return (<LoadingDialog />)\r\n    }\r\n\r\n    return (<Navigate to={`${booking.result ? '/profile' : '/tours'}`} />)\r\n}\r\n\r\nexport default memo(AfterPay)"],"mappings":"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"},"metadata":{},"sourceType":"module"}